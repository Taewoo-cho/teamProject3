<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
	$.ajax ({
		url: "/myPage",
		method: "post",
		contentType: "application/json; charset=UTF-8",
		success: function(data) {
			$("#user-id").val(data.userId);
			$("#user-nick").val(data.userNick);
			$("#user-phone").val(data.userPhone);
			$("#user-addr").val(data.userAddr);
		},
		error: function() {
			alert("데이터를 불러오는데 실패함");
		}
	});
	
	$(".btn-delete").on("click", function() {
		
		var arr = [];
		var orders = $(".order-no");
		
		for (var i = 0; i < orders.length; i++) {
			arr[i] = $(orders[i]).text();
		}
		
		$.ajax({
			url: "/clear",
			type: "DELETE",
			data: {no : arr},
			success: function(data) {
				if (data == "success") {
					alert("게산이 완료되었습니다.");
					location.href="/main";
				}
				else {
					alert("계산 중 오류가 발생했습니다.");
				}
			},
			error: function() {
				alert("dddd");
			}
		});
		
// 		var no = $(this).children("span").text();
// 		var frm = $("#frm")[0];
// 		var formData = new FormData(frm);
// 		var no= [];
// 		no=arr;
// 		formData.append("no", arr);
// 		formData.get("no");
// 		console.log(no);
// 		frm.action = "/clear"
// 		frm.submit();
	});
});
</script>
	

</head>
<body>
	<header th:include="layout/header :: header"></header>

	<main>
		<div class="container">
			<div class="mt-2 p-5">
				<h3>카테고리</h3>
				<div class="border p-3"
					style="width: 1150px; height: 850px; border-radius: 40px; border-color: #0099ff;">
					<div class="my-3 clearfix">
						<div class="container p-5 bg-secondary bg-opacity-25 text-center">
							<h1 class="text-center">주문 제품 리스트</h1>
						</div>
						<div class="row">
							<div class="col-sm-7">
								<div class="my-3">
									<input type="text" class="form-control" id="user-nick" name="userNick" placeholder="닉네임" readonly>
								</div>
								<div class="my-3">
									<textarea rows="5" class="form-control" id="user-addr" name="userAddr" placeholder="주소를 입력하세요"></textarea>
								</div>
								<div class="my-3">
									<input type="text" class="form-control" id="user-phone" name="userPhone" placeholder="전화번호" readonly>
								</div>
							</div>
							<div class="col-sm-5">
								<form id="frm" method="post">
								<div class="my-3 d-grid gap-2">
									<table class="table table-hover table-striped">
										<colgroup>
											<col width="60%" />
											<col width="40%" />
										</colgroup>
										<thead>
											<tr>
												<th>메뉴</th>
												<th>가격</th>
											</tr>
										</thead>
										<tbody>
											<tr th:if="${#lists.size(prices)} > 0" th:each="list : ${prices}">
												<td th:text="${list.no}" class="d-none order-no"></td>
												<td th:text="${list.shopMenu}"></td>
												<td th:text="${list.shopMprice} + ' 원'"></td>
											</tr>
										</tbody>
									</table>	
									<button type="button" class="btn btn-primary btn-delete" >계산하기</button>
									<!-- <script>
										function alertDialogBox() {
											alert("게산이 완료되었습니다.")
										}
									</script> -->
									<input type="hidden" id="method" name="_method">
								</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<footer th:replace="layout/footer :: footer"></footer>
</body>
</html>